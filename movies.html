<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHT</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="movies-container">
        <h1>Äi coi phimmm!!! ğŸ”¥</h1>
        <div class="date-picker">
            <label for="movie-date">NgÃ y Ä‘i coi phim nÃ¨ ğŸ“…</label>
            <input type="date" id="movie-date">
            <p id="date-message" class="date-message"></p>
        </div>
        <div class="movie-selection" id="movie-selection" style="display: none;">
            <h3>Danh sÃ¡ch phim Ä‘ang chiáº¿u ğŸ¥</h3>
            <div class="movie-list">
                <label><input type="radio" name="movie" value="NHÃ€ BA TÃ”I Má»˜T PHÃ’NG">NHÃ€ BA TÃ”I Má»˜T PHÃ’NG</label>
                <label><input type="radio" name="movie" value="BÃU Váº¬T TRá»œI CHO">BÃU Váº¬T TRá»œI CHO</label>
                <label><input type="radio" name="movie" value="THá» Æ I!!">THá» Æ I!!</label>
                <label><input type="radio" name="movie" value="MÃ™I PHá»">MÃ™I PHá»</label>
                <label><input type="radio" name="movie" value="BIÃŠÌ£T ÄÃ”Ì£I THUÌ CÆ¯NG: CUÃ”Ì£C CHIÃŠÌN TRÃŠN ÄÆ¯Æ Ì€NG RAY">BIÃŠÌ£T ÄÃ”Ì£I THUÌ CÆ¯NG: CUÃ”Ì£C CHIÃŠÌN TRÃŠN ÄÆ¯Æ Ì€NG RAY</label>
                <label><input type="radio" name="movie" value="THá» GÃ€ DU XUÃ‚N Äáº I NÃO Äá»ŠA Äáº O">THá» GÃ€ DU XUÃ‚N Äáº I NÃO Äá»ŠA Äáº O</label>
                <label><input type="radio" name="movie" value="TUYá»‚N THá»¦ DÃŠ - â€œMÃ™Iâ€ Vá»Š CHIáº¾N THáº®NG">TUYá»‚N THá»¦ DÃŠ - â€œMÃ™Iâ€ Vá»Š CHIáº¾N THáº®NG</label>
                <label><input type="radio" name="movie" value="PHI Vá»¤ Äá»˜NG TRá»œI 2">PHI Vá»¤ Äá»˜NG TRá»œI 2</label>
                <label><input type="radio" name="movie" value="AVATAR 3: Lá»¬A VÃ€ TRO TÃ€N">AVATAR 3: Lá»¬A VÃ€ TRO TÃ€N</label>
                <label><input type="radio" name="movie" value="KUMANTHONG ÄÃ€I LOAN: OÃN THAI ÄÃ’I Máº¸">KUMANTHONG ÄÃ€I LOAN: OÃN THAI ÄÃ’I Máº¸</label>
                <label><input type="radio" name="movie" value="RUNNING MAN VIá»†T NAM MÃ™A 3 - CON Rá»I Tá»° DO">RUNNING MAN VIá»†T NAM MÃ™A 3 - CON Rá»I Tá»° DO</label>
                <label><input type="radio" name="movie" value="TIá»‚U YÃŠU QUÃI NÃšI LÃƒNG LÃƒNG">TIá»‚U YÃŠU QUÃI NÃšI LÃƒNG LÃƒNG</label>
                <label><input type="radio" name="movie" value="HUYá»€N TÃŒNH Dáº  TRáº CH">HUYá»€N TÃŒNH Dáº  TRáº CH</label>
                <label><input type="radio" name="movie" value="Táº¦M Táº¦N KÃ">Táº¦M Táº¦N KÃ</label>
            </div>
        </div>
        <button id="final-confirm" class="btn btn-yes" style="margin-top: 1rem; display: none;">
            XÃ¡c nháº­n Ä‘áº·t lá»‹ch ğŸŸ
        </button>
    </div>
    <div id="success-screen" style="display: none;" class="success-screen">
        <h1>ğŸ‰ ChÃºc má»«ng!!! ğŸ‰</h1>
        <p id="success-message"></p>
    </div>

    <script>
        const dateInput = document.getElementById('movie-date');
        const movieSelection = document.getElementById('movie-selection');
        const dateMessage = document.getElementById('date-message');
        const finalConfirmBtn = document.getElementById('final-confirm');

        let isDateValid = false;

        function checkShowConfirmButton() {
            const selectedMovie = document.querySelector('input[name="movie"]:checked');

            if (isDateValid && selectedMovie) {
                finalConfirmBtn.style.display = "inline-block";
            } else {
                finalConfirmBtn.style.display = "none";
            }
        }

        // Kiá»ƒm tra ngÃ y realtime
        dateInput.addEventListener('change', () => {

            if (!dateInput.value) {
                dateMessage.textContent = "";
                movieSelection.style.display = "none";
                isDateValid = false;
                checkShowConfirmButton();
                return;
            }

            const selectedDate = new Date(dateInput.value);
            const today = new Date();

            today.setHours(0, 0, 0, 0);
            selectedDate.setHours(0, 0, 0, 0);

            const diffTime = selectedDate - today;
            const diffDays = diffTime / (1000 * 60 * 60 * 24);

            if (diffDays < 0) {
                dateMessage.textContent = "âŒ NgÃ y nÃ y qua rá»“i nÃ­ Æ¡i -.-.-";
                dateMessage.style.color = "red";
                movieSelection.style.display = "none";
                isDateValid = false;
                checkShowConfirmButton();
                return;
            }

            if (diffDays > 7) {
                dateMessage.textContent = "âš  LÃ¢u quÃ¡... chá»n ngÃ y gáº§n gáº§n thui em -.-";
                dateMessage.style.color = "orange";
                movieSelection.style.display = "none";
                isDateValid = false;
                checkShowConfirmButton();
                return;
            }

            dateMessage.textContent = "âœ… Okie! Giá» chá»n phim Ä‘i nÃ¨ ğŸ¬";
            dateMessage.style.color = "#4CAF50";
            movieSelection.style.display = "block";
            isDateValid = true;

            checkShowConfirmButton();
        });

        // Khi chá»n phim
        document.addEventListener('change', function(e) {
            if (e.target.name === "movie") {
                checkShowConfirmButton();
            }
        });

        const successScreen = document.getElementById('success-screen');
        const moviesContainer = document.querySelector('.movies-container');
        const successMessage = document.getElementById('success-message');

        finalConfirmBtn.addEventListener('click', async () => {
    const selectedMovie = document.querySelector('input[name="movie"]:checked');

    if (!isDateValid || !selectedMovie) return;

    const movieName = selectedMovie.value;
    const selectedDate = dateInput.value;

    finalConfirmBtn.disabled = true;
    finalConfirmBtn.textContent = "Äang gá»­i... â³";

    // THAY Báº°NG URL WEB APP Báº N Vá»ªA COPY
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzezacXYwImi-frZ4nrZ1ln6u3-qu3x-Hng0DrZuDGDt9zu3HasROJ19L9YQ-ZsSWTvmw/exec';  

    try {
        const response = await fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',           // giá»¯ nguyÃªn vÃ¬ GAS khÃ´ng há»— trá»£ CORS Ä‘áº§y Ä‘á»§
            redirect: 'follow',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                movieName: movieName,
                selectedDate: selectedDate
            })
        });

        // VÃ¬ no-cors â†’ khÃ´ng Ä‘á»c Ä‘Æ°á»£c response, ta giáº£ Ä‘á»‹nh thÃ nh cÃ´ng náº¿u khÃ´ng lá»—i
        successMessage.innerHTML = 
            `Báº¡n Ä‘Ã£ Ä‘áº·t lá»‹ch xem <strong>${movieName}</strong><br>` +
            `vÃ o ngÃ y <strong>${selectedDate}</strong> cÃ¹ng CHT ğŸ‰`;

        moviesContainer.style.display = "none";
        successScreen.style.display = "flex";

    } catch (error) {
        console.error('Lá»—i:', error);
        alert("CÃ³ lá»—i khi gá»­i! Kiá»ƒm tra láº¡i URL hoáº·c káº¿t ná»‘i nhÃ©.");
        finalConfirmBtn.disabled = false;
        finalConfirmBtn.textContent = "XÃ¡c nháº­n Ä‘áº·t lá»‹ch ğŸŸ";
    }
});


    </script>

</body>
</html>
